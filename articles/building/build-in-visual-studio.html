<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Building nanoFramework in Visual Studio | nanoFramework Documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Building nanoFramework in Visual Studio | nanoFramework Documentation ">
    <meta name="generator" content="docfx 2.42.4.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items"></div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="building-nanoframework-in-visual-studio">Building <strong>nanoFramework</strong> in Visual Studio</h1>

<h2 id="developing-firmware-for-the-nanoframework-using-visual-studio-2017-community-edition">Developing firmware for the nanoframework using Visual Studio 2017 community edition</h2>
<h5 id="-important--the-firmware-build-for-visual-studio-is-under-construction-">🚧 IMPORTANT : The firmware build for Visual Studio is under construction. 🚧</h5>
<p>Some compromises were required to get this to a working stage.
I made a decision to put the code at the top level to reduce path length of files which caused warnings of the potential to overflow the command line.</p>
<blockquote>
<p>Hard coded paths are used to ensure it works with the current CMake coding and the Microsoft usage of CMake
There are some issues with the CMakeSettings.json file with path separators.</p>
</blockquote>
<br>
<h3 id="directory-structure-for-the-project">Directory structure for the project</h3>
<p>Two top level directories have been created to support the development with Visual Studio.</p>
<ul>
<li><code>c:\nanoFramework\nf-interpreter</code></li>
<li><code>c:\nanoFramework_Tools</code></li>
</ul>
<h4 id="cnanoframeworknf-interpreter">c:\nanoFramework\nf-interpreter</h4>
<ul>
<li>The nf-interpreter repository is cloned to this directory.</li>
</ul>
<h6 id="cnanoframeworknf-interpreterbuild">c:\nanoFramework\nf-interpreter\Build</h6>
<ul>
<li>This directory contains the build output, the files in here are transient. When the CMake cache is deleted, files in this directory are deleted.
The files in this directory are only visible when selecting &quot;Show All Files&quot;. These files are not part of the GIT repository.
At the end of a successful build the build outputs are copied to the <em>\Build</em> directory.</li>
</ul>
<blockquote>
<ul>
<li>Note: It is sometimes necessary to delete the contents of these folders if Visual Studio misbehaves.
Using Visual Studio with CMake results in what appears to be inconsistencies at times.
Sometime the CMake server goes away, shutting down Visual Studio and restarting usually fixes the problem.
<br></li>
<li>Note: After clearing the Cmake cache, on occassions the build/chibios_source directory is left empty or only containing the .git file
due to some conflict. The current CMakeLists.txt file finds the directory and does not re-copy the code.
It is necessary to manually delete the directory from file explorer and generate the cache for the copy to run.
_</li>
</ul>
</blockquote>
<h4 id="cnanoframework_tools">c:\nanoFramework_Tools\</h4>
<p>Manually create this directory to contain the following folders.</p>
<h6 id="cnanoframework_toolschibios">c:\nanoFramework_Tools\ChibiOS</h6>
<ul>
<li>Copy of the ChibiOS repository cloned from <a href="https://github.com/nanoframework/chibios.git">https://github.com/nanoframework/chibios.git</a></li>
</ul>
<h6 id="cnanoframework_toolstoolsopenocd">C:\nanoFramework_Tools\Tools\openocd</h6>
<ul>
<li>Copy of the openocd installation <a href="http://www.freddiechopin.info/en/download/category/4-openocd">http://www.freddiechopin.info/en/download/category/4-openocd</a></li>
<li>
<blockquote>
<p>Currently version 0.10.0</p>
</blockquote>
</li>
</ul>
<h6 id="cnanoframework_toolstools">C:\nanoFramework_Tools\Tools\</h6>
<ul>
<li>Place a copy of the hex2dfu.exe tool here</li>
</ul>
<h3 id="example-of-the-directory-structure">Example of the directory structure</h3>
<p><img src="VSDevDirectoryStructure.png" alt=""></p>
<h3 id="major-configuration-files">Major configuration files</h3>
<h5 id="cmakesettingsjson">CMakeSettings.json</h5>
<blockquote>
<p>Configuration file used by Visual Studio. This is the standard configuration file for CMake development.
This file can contain more than one configuration. In addition to setting the compiler
toolchain, additional variables are defined to select the target hardware and operating system to build.</p>
<h6 id="note-work-in-progress">Note: Work in progress</h6>
</blockquote>
<br>
<h5 id="cmakeliststxt">CMakeLists.txt</h5>
<blockquote>
<p>This is the standard CMakeLists.txt file for the nf-intepreter</p>
</blockquote>
<br>
<h5 id="launchvsjson">launch.vs.json</h5>
<blockquote>
<p>Sets up the debugging environment using the gdbserver debugging via configurations.
The example references the openocd application.</p>
</blockquote>
<br>
<h4 id="setup-and-installation">Setup and Installation</h4>
<table>
<thead>
<tr>
<th style="text-align: left;">Software Component</th>
<th>Notes</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Visual Studio 2017 community edition</td>
<td>Linux development with C++</td>
<td></td>
</tr>
<tr>
<td style="text-align: left;">option</td>
<td>Visual C++ tools for Cmake and Linux</td>
<td></td>
</tr>
<tr>
<td style="text-align: left;">option</td>
<td>Embedded and IoT Development</td>
<td>GCC version 6.3.1. December/2018</td>
</tr>
<tr>
<td style="text-align: left;">GCC Tool Chain - Version 7-2018-q2-update</td>
<td>GNU Arm Embedded Toolchain</td>
<td>https://developer.arm.com/open-source/gnu-toolchain/gnu-rm/downloads#</td>
</tr>
</tbody>
</table>
<h4 id="gcc-toolchain-notes">GCC Toolchain NOTES</h4>
<blockquote>
<p>Version 6.3.1 installed by Visual Studio has a problem with fallthrough, Version 8, has a problem with structures ( an issue has been raised to fix this)</p>
</blockquote>
<p>The following GCC version has been download, installed and tested.</p>
<blockquote>
<p>GNU Arm Embedded Toolchain - Version 7-2018-q2-update
<a href="https://developer.arm.com/open-source/gnu-toolchain/gnu-rm/downloads#">https://developer.arm.com/open-source/gnu-toolchain/gnu-rm/downloads#</a></p>
</blockquote>
<p>In CMakeSettings.json the following variables determine the build tool.</p>
<pre><code>    {
      &quot;name&quot;: &quot;TOOLCHAIN_PREFIX&quot;,
      &quot;value&quot;: &quot;C:/Program Files (x86)/GNU Tools Arm Embedded/7 2018-q2-update&quot;
      // &quot;value&quot;: &quot;${env.GCCPATH}&quot;   // Standard Visual Studio Install of GCC 6.3.1 
    },
</code></pre>
<p>In CMakeSettings.json the VISUAL_STUDIO variable sets up a workaround for a problem with the build system.
If you use the <code>add_custom_command</code> with <code>POST_BUILD</code> then the build compiles but does not link due to a 'cmd.exe' not recognized'</p>
<pre><code>    {
      &quot;name&quot;: &quot;VISUAL_STUDIO&quot;,
      &quot;value&quot;: &quot;TRUE&quot;
    },
</code></pre>
<p>To avoid the problem the custom command to copy the build outputs is not run.
An equivalent of this can be run by executing <code>CopyBuildOutput.cmd</code> manually from the command prompt.
<br>
<br></p>
<h4 id="debugging">Debugging</h4>
<p>The launch.vs.json file contains an example configuration for setup to debug the STM32769IDiscovery board.
Additonal configurations can be added, although the implementation of the options does not seem consistent with
the VSCODE version and some options do not appear to work properly.
Also, the whole system is a bit flakey. The openocd program is run as sub process of Visual Studio,and if it runs into problems the
system fails, and you must run up task manager to end the openocd.exe task listed as a process of Visual Studio.</p>
<h4 id="diagnosing-problems-with-the-debug-and-launchvsjson">Diagnosing problems with the debug and launch.vs.json</h4>
<p>You can get a better understanding of problems that may be occuring with the gdb/openocd debug setup.
In Visual Studio select the Command Window Ctrl+Alt+A, and turn on debug logging with the following command.</p>
<p><code>debug.midebuglog /On:c:\Temp\debug.log</code></p>
<p>Run a debugging session to collect data and turn it off with the following command.</p>
<p><code>debug.midebuglog /Off</code></p>
<p>This will give you a log of the operation and communications occuring. ( Good luck!)</p>
<p><strong><em>An example snippet displays error for &quot;Monitor reset halt ( not quite sure why?)</em></strong></p>
<pre><code>    8: (1976730) -&gt;^done
    8: (1976730) &lt;-1005-interpreter-exec console  &quot;monitor reset halt&quot;
    8: (1976730) -&gt;(gdb)`
    8: (1976741) -&gt;&amp;&quot;\&quot;monitor\&quot; command not supported by this target.\n&quot;
    8: (1976742) -&gt;1005^error,msg=&quot;\&quot;monitor\&quot; command not supported by this target.&quot;
    8: (1976742) -&gt;(gdb)
    8: (1976742) 1005: elapsed time 11
    8: (1976742) &lt;-1006-interpreter-exec console &quot;monitor reset init&quot;
    8: (1976742) -&gt;&amp;&quot;\n&quot;
    8: (1976742) -&gt;^done
    8: (1976742) -&gt;(gdb)
</code></pre>
<h4 id="feedback">Feedback</h4>
<p>If you are using this your feedback is greatly appreciated. Please join our <a href="https://discord.gg/gCyBu8T">Discord community</a> and start chatting about this.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/nanoframework/nanoframework.github.io/blob/pages-source/articles/building/build-in-visual-studio.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2018 nanoFramework Contributors<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
